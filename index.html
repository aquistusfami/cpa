<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính CPA HUST</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #cc0000;
        }
        .input-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        input, select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            flex: 1;
            min-width: 120px;
            font-size: 14px;
        }
        .btn-primary {
            padding: 10px 20px;
            background-color: #cc0000;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            min-width: 100px;
            font-size: 14px;
        }
        .btn-primary:hover {
            background-color: #a30000;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
        }
        .delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }
        .result-section {
            margin-top: 20px;
            background: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2em;
        }
        .highlight {
            font-size: 1.5em;
            font-weight: bold;
            color: #cc0000;
        }
    </style>
</head>
<body>

    <h1>Công cụ tính CPA - HUST</h1>

    <div class="input-section">
        <input type="text" id="maHP" placeholder="Mã HP (VD: IT1110)" oninput="tuDongDienThongTin()">
        <input type="text" id="tenMon" placeholder="Tên môn học">
        <input type="number" id="soTinChi" placeholder="Số tín chỉ" min="1">
        
        <select id="diemChu">
            <option value="" disabled selected>Chọn điểm chữ</option>
            <option value="A">A</option>
            <option value="B+">B+</option>
            <option value="B">B</option>
            <option value="C+">C+</option>
            <option value="C">C</option>
            <option value="D+">D+</option>
            <option value="D">D</option>
            <option value="F">F</option>
        </select>

        <button class="btn-primary" onclick="themMonHoc()">Thêm môn</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Mã HP</th>
                <th>Tên môn</th>
                <th>Tín chỉ</th>
                <th>Điểm chữ</th>
                <th>Điểm hệ 4</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody id="bangMonHoc">
            </tbody>
    </table>

    <div class="result-section">
        <p>Tổng số tín chỉ tính CPA: <span id="tongTin" class="highlight">0</span></p>
        <p>Điểm CPA tích lũy: <span id="diemCPA" class="highlight">0.00</span></p>
    </div>

    <script>
        // CƠ SỞ DỮ LIỆU MÔN HỌC (Bạn có thể thêm thủ công các môn phổ biến vào đây)
        const coSoDuLieuHUST = {
            "IT1110": { ten: "Tin học đại cương", tinChi: 4 },
            "MI1111": { ten: "Giải tích 1", tinChi: 4 },
            "MI1121": { ten: "Giải tích 2", tinChi: 4 },
            "MI2020": { ten: "Xác suất thống kê", tinChi: 3 },
            "PH1110": { ten: "Vật lý đại cương 1", tinChi: 3 },
            "PH1120": { ten: "Vật lý đại cương 2", tinChi: 3 }
        };

        // Khởi tạo mảng danh sách môn học
        let danhSachMon = [];

        // --- TÍNH NĂNG MỚI: TẢI DỮ LIỆU TỪ LOCAL STORAGE KHI MỞ WEB ---
        function taiDuLieuTuBoNho() {
            let duLieuDaLuu = localStorage.getItem("duLieuCPA_HUST");
            if (duLieuDaLuu) {
                // Biến chuỗi JSON trở lại thành mảng Javascript
                danhSachMon = JSON.parse(duLieuDaLuu);
                // Hiển thị ra màn hình
                capNhatGiaoDien();
            }
        }

        // Tự động điền thông tin khi gõ Mã HP
        function tuDongDienThongTin() {
            let maHPNhapVao = document.getElementById('maHP').value.toUpperCase().trim();
            let thongTinMon = coSoDuLieuHUST[maHPNhapVao];

            if (thongTinMon) {
                document.getElementById('tenMon').value = thongTinMon.ten;
                document.getElementById('soTinChi').value = thongTinMon.tinChi;
            }
        }

        // Quy đổi thẳng từ Điểm Chữ sang hệ 4
        function quyDoiHUST(diemChu) {
            const bangDiem = {
                "A": 4.0, "B+": 3.5, "B": 3.0, "C+": 2.5, "C": 2.0, "D+": 1.5, "D": 1.0, "F": 0.0
            };
            return bangDiem[diemChu] !== undefined ? bangDiem[diemChu] : 0.0;
        }

        // Thêm môn học mới
        function themMonHoc() {
            let maHP = document.getElementById('maHP').value.toUpperCase().trim();
            let ten = document.getElementById('tenMon').value;
            let tinChi = parseFloat(document.getElementById('soTinChi').value);
            let diemChu = document.getElementById('diemChu').value;

            if (!ten || isNaN(tinChi) || !diemChu) {
                alert("Vui lòng nhập tên môn, số tín chỉ và chọn điểm chữ!");
                return;
            }

            danhSachMon.push({
                maHP: maHP || "---",
                ten: ten,
                tinChi: tinChi,
                diemChu: diemChu,
                diem4: quyDoiHUST(diemChu)
            });

            // Xóa trắng ô nhập sau khi thêm
            document.getElementById('maHP').value = '';
            document.getElementById('tenMon').value = '';
            document.getElementById('soTinChi').value = '';
            document.getElementById('diemChu').value = '';

            capNhatGiaoDien();
        }

        // Xóa môn học
        function xoaMon(index) {
            danhSachMon.splice(index, 1);
            capNhatGiaoDien();
        }

        // Cập nhật bảng, tính CPA và LƯU LẠI DỮ LIỆU
        function capNhatGiaoDien() {
            let tbody = document.getElementById('bangMonHoc');
            tbody.innerHTML = '';
            
            let tongTinChi = 0;
            let tongDiem4 = 0;

            danhSachMon.forEach((mon, index) => {
                let row = `<tr>
                    <td><strong>${mon.maHP}</strong></td>
                    <td>${mon.ten}</td>
                    <td>${mon.tinChi}</td>
                    <td><strong><span style="color:#cc0000">${mon.diemChu}</span></strong></td>
                    <td>${mon.diem4.toFixed(1)}</td>
                    <td><button class="delete-btn" onclick="xoaMon(${index})">Xóa</button></td>
                </tr>`;
                tbody.innerHTML += row;

                tongTinChi += mon.tinChi;
                tongDiem4 += (mon.diem4 * mon.tinChi);
            });

            // Hiển thị kết quả
            document.getElementById('tongTin').innerText = tongTinChi;
            let cpa = tongTinChi === 0 ? 0 : (tongDiem4 / tongTinChi);
            document.getElementById('diemCPA').innerText = cpa.toFixed(2);

            // --- TÍNH NĂNG MỚI: LƯU TRẠNG THÁI MỚI NHẤT VÀO LOCAL STORAGE ---
            // Biến mảng danhSachMon thành chuỗi văn bản (JSON) để lưu trữ
            localStorage.setItem("duLieuCPA_HUST", JSON.stringify(danhSachMon));
        }

        // Gọi hàm tải dữ liệu ngay khi trang web vừa load xong
        window.onload = taiDuLieuTuBoNho;
    </script>
</body>
</html>
